# 아이템 24 멤버 클래스는 되도록 static으로 만들어라

<aside>
💡 멤버 클래스는 되도록 정적 멤버 클래스로 만들어라

</aside>

**중첩 클래스(nested class)**란 다른 클래스 안에 정의된 클래스를 의미한다. 중첩 클래스는 자신을 감싼 바깥 클래스에서만 쓰여야 하며, 그 외의 쓰임새가 있다면 **톱 레벨 클래스**로 만들어야 한다. 

### 톱레벨 클래스란?

여태까지 일반적으로 사용해왔던 클래스이다. 가장 바깥에 존재하는 클래스이기 때문에 top level이라는 이름이 붙여졌다. 내부 클래스, 즉 내부에 클래스가 존재하는 클래스와 구분하기 위해 붙여진 이름이기 때문에 어렵게 생각할 필요없다. 

아래는 중첩클래스의 종류를 정리한 그림이다. 중첩 클래스에는 1. 정적 멤버 클래스, 2. 비 정적 멤버 클래스, 3. 익명 클래스, 4. 지역 클래스가 있다. 이 중 1을 제외한 나머지 클래스는 내부 클래스라고 한다. 

![클래스 분류](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/bb09931d-7481-4d97-8eba-de2f77728979/Untitled.png)

클래스 분류

위 멤버 클래스와 내부 클래스의 교집합이 아닌 부분이 정적 멤버 클래스가 된다. 

![클래스 종류 - 직접그림...ㅎㅎ](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/50b938fa-e95d-4e41-8b6d-b4c4b5a388f8/Untitled.png)

클래스 종류 - 직접그림...ㅎㅎ

[자바의 내부클래스(Nested Classes)](http://alecture.blogspot.com/2011/05/nested-classes.html)

참고한 블로그

<aside>
💡 각 중첩 클래스를 **언제**, 그리고 **왜** 사용하는지 알아보자

</aside>

# 01 정적 멤버 클래스

> 정적 멤버 클래스는 1. **다른 클래스 안에 선언**되고, 2. **바깥 클래스의 private 멤버에도 접근**할 수 있다는 점만 제외하고는 일반 클래스와 똑같다.
> 

정적 멤버 클래스는 다른 정적 멤버와 똑같은 접근 규칙을 적용받는다. 예를 들면 private으로 선언하면 바깥 클래스에서만 접근할 수 있는 것이 있다. 

***정적 멤버 클래스는 바깥 클래스와 함께 쓰일 때만 유용한 public 도우미 클래스로 쓰인다.*** 

```java
public class Main {
    private int x = 10;

    private static class InnerClass {
        void test() {
            Main outerClass = new Main();
            outerClass.x = 100;
        }
    }
}
```

- 클래스 안쪽에 static 클래스를 선언하여 바깥 클래스를 사용할 때 클래스를 자동으로 생성한다.
- 바깥 클래스를 사용할 때 자연스럽게 사용되기 때문에 **헬퍼 클래스**라고도 한다.
- 매번 바깥 클래스를 호출할 때마다 내부 클래스를 재생성하는 것은 메모리 효율에 좋기 않기 때문에 내부 클래스에서 바깥 객체에 접근할 필요가 없는 클래스의 경우 static을 붙여 생성시키고 쓴다.
- 이 경우 정적 멤버 클래스는 바깥 클래스의 모든 변수에 접근이 가능하다. private으로 만들어졌다고 하더라도 가능하다.

# 02 비정적 멤버 클래스

> 비정적 멤버 클래스는 바깥 클래스의 인스턴스와 암묵적으로 연결된다.
> 

위에서 말한 특징 때문에 비정적 멤버 클래스의 인스턴스 메서드에서 this를 사용하여 바깥 인스턴스의 메서드를 호출하거나 바깥 인스턴스의 참조를 가져올 수 있다.

```java
public class Main {

    void Hello(){
        System.out.println("Hello");
    }
    
    private class InnerClass {
        void test() {
            Main.this.Hello(); //정규화된 this = 클래스명.this로 가져오기
        }
    }
}
```

- 비 정적 멤버 클래스는 정적 멤버 클래스와 다르게 바깥 클래스의 존재 없이는 존재할 수 없는 클래스이다. 때문에 이 클래스만 독립적으로 존재하도록 하고 싶다면 중첩 클래스는 반드시 static을 붙여줘야 한다.
- 비정적 멤버 클래스의 인스턴스와 바깥 인스턴스 사이의 관계는 멤버 클래스가 인스턴스화 될 때 확립되며, 더 이상 변경할 수 없다.

**그럼 비정적 멤버 클래스는 언제 쓰일까?**

**어댑터**를 정의할 때 자주 쓰인다. 

### 어댑터란?

[Java(자바) 디자인패턴 - 어댑터(Adapter) 패턴 설명 및 예제소스](https://niceman.tistory.com/141)

자바 디자인 패턴 중 빈번하게 사용되는 패턴

어댑터 패턴은 한 클래스의 인터페이스를 사용하고자 하는 다른 인터페이스로 변환할 때 주로 사용한다. 이를 사용하면 인터페이스간 호환성이 맞지 않아 같이 쓸 수 없는 클래스를 연관관계로 연결하여 사용이 가능하게끔 해주는 패턴이다. 

장점

1. 관계가 없는 인터페이스 간 같이 사용 가능
2. 프로그램 검사 용이
3. 클래스 재활용성 증가

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6317b892-6008-44a8-9e8d-bdcda342cbfa/Untitled.png)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/43e0011f-5026-4071-be7c-11b834762c77/Untitled.png)

mediaPlayer를 구현하는 mp3타입으로 생성한 객체를 MediaPackge인 MP4타입으로 변환하고 싶을 때 받고 있는 인터페이스의 종류가 달라 호환이 원래는 불가능하지만, 두가지 인터페이스를 연결해주는 FormatAdapter를 통해 변환이 가능해진다.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/631197e2-e1bc-4b2a-a342-129c5248f41a/Untitled.png)

어댑터 패턴은 기존 클래스의 소스코드를 수정해서 인터페이스에 맞추는 작업보다는 기존 클래스의 소스코드 수정을 전혀 하지 않고 타겟 인터페이스에 맞춰서 동작이 가능하게끔 만들어준다. 

즉, 어떤 클래스의 인스턴스를 감까 마치 다른 클래스의 인스턴스처럼 보이게 하는 뷰로 사용하는 것이다. Map, Set, List에서 주로 비정적 멤버 클래스를 사용한다. 

멤버 클래스에서 바깥 인스턴스에 접근할 일이 없다면 무조건 static을 붙여서 정적 멤버 클래스를 만들자.

- static을 생략하면 바깥 인스턴스로의 숨은 외부 참조를 갖게 됨
- 참조를 저장하려면 시공간이 소비됨
- 가비지 컬렉터가 바깥 클래스의 인스턴스를 수거하지 못하는 메모리 누수 발생

# 03 익명 클래스

- 이름이 없다
- 바깥 클래스의 멤버가 아니다. 멤버와 달리 쓰이는 시점에 선언과 동시에 인스턴스가 만들어진다.
- 비정적인 문맥에서 사용될 때만 바깥 클래스의 인스턴스를 참조할 수 있다.
- 상수 변수 이외의 정적 멤버는 가질 수 없다.

제약

- 선언한 지점에서만 인스턴스를 만들 수 있다
- 여러 인터페이스를 구현할 수 없고, 인터페이스를 구현하는 동시에 다른 클래스를 상속할 수도 없다.
- 익명 클래스가 상위타입에서 상속한 멤버 이외에는 호출할 수 없다.
- 표현식 중간에 등장하므로 짧지 않으면 가독성이 떨어진다.

주로 정적 팩터리 메서드를 구현할 때 사용된다. 

# 04 지역 클래스

- 지역변수를 선언할 수 있는 곳이면 어디서든 선언 가능하다
- 멤버클래스처럼 이름이 있고 반복사용 가능하다
- 비정적 문맥에서 사용될 때만 바깥 인스턴스를 참조할 수 있다.
- 정적 멤버는 자실 수 없으며 가독성을 위해 짧게 작성해야 한다.

# 정리

<aside>
💡 1. 메서드 밖에서도 사용해야 한다면 멤버 클래스로 만든다.
2. 멤버 클래스의 인스턴스가 바깥 인스턴스를 참조한다면 비정적으로, 그렇지 않으면 정적으로 만든다.
3. 중첩 클래스가 한 메서드 안에서만 쓰이면 익명 클래스로 만든다.
4. 그렇지 않으면 지역 클래스로 만든다.

</aside>
